<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.comdosoft.financial.manage.mapper.zhangfu.AgentJoinMapper">


	<resultMap id="BaseResultMap" type="com.comdosoft.financial.manage.domain.zhangfu.AgentJoin">
		<!-- WARNING - @mbggenerated This element is automatically generated by MyBatis Generator, do not modify. -->
		<id column="id" jdbcType="INTEGER" property="id" />
	</resultMap>
	
	<sql id="pageWhere">
		<where>
			<if test="statu != null and statu != 0"> AND statu =#{statu} </if>
			<if test="keys != null"> AND touch_name like '%${keys}%' </if>
			<if test="1==1">
				AND statu  <![CDATA[ <= ]]>3
			</if>
		</where>
	</sql>

	<select id="findAgentJoinInfoByType" resultMap="BaseResultMap">
		select id , process_user_id, agent_type as type,address,
		statu as status,touch_name as name,touch_phone as phone,DATE_FORMAT(create_date,'%Y-%m-%d
		%H:%i:%s') as date from agents_join as aj 
		<include refid="pageWhere"></include>
		order by process_user_id = #{id} desc,date desc limit #{pageRequest.offset}, #{pageRequest.pageSize}
	</select>


	<select id="countByKeys" resultType="long">
		SELECT count(id) as count FROM agents_join 
		<include refid="pageWhere" />
	</select>
	
	
	<update id="dispatch">
      update agents_join set process_user_id = #{customerId} where id in 
      <foreach item="item" index="index" collection="ids" open="(" separator="," close=")">#{item}</foreach>  
  	</update>
  	
  	
	<update id="upStatus">
		update agents_join set statu=#{status} where id=#{id}
	</update>
  	
  	<select id="findInfo" resultMap="BaseResultMap">
		SELECT
		ci.id,ci.process_user_id,ci.touch_name as name,ci.touch_phone as phone,ci.address,
		c.name as processname,ci.statu as status,ci.agent_type as type ,DATE_FORMAT(ci.create_date,'%Y-%m-%d %H:%i:%s') as date
		FROM agents_join ci
		left join customers c on c.id=ci.process_user_id
		where ci.id=#{id}
	</select>
  	
</mapper>